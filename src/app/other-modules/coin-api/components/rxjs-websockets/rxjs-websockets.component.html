<app-exchange-rate-panel
  *ngIf="ratePairOptions.length > 0"
  (ratesSelected)="ratesSelected($event)"
  [ratePairsOption]="ratePairOptions"
></app-exchange-rate-panel>

<div class="controls-container">
  <button mat-raised-button [matBadge]="coinPairs.length" (click)="getTrades()">
    get exchange rates
  </button>
  <button mat-mini-fab (click)="stop()"><mat-icon>stop</mat-icon></button>
  <button mat-button (click)="test()">test</button>

  <mat-form-field>
    <input
      [formControl]="maxPointsCount$"
      matInput
      placeholder="points on chart ({{ maxPointsCount }})"
    />
  </mat-form-field>
</div>

<mat-divider></mat-divider>

<div fxLayout="row wrap">
  <ng-container
    *ngFor="let selectedChart of selectedCharts; index as i; first as isFirst"
  >
    <mat-card [fxFlex]="selectedChart.size">
      <div fxLayout fxLayoutAlign="space-between center">
        <div fxLayout fxLayoutGap="5px" fxLayoutAlign="center center">
          <img
            [attr.src]="selectedChart.chart.asset_id_base_logo"
            mat-card-avatar
            class="example-header-image"
          />
          <div>&nbsp;=>&nbsp;</div>
          <img
            [attr.src]="selectedChart.chart.asset_id_quote_logo"
            mat-card-avatar
            class="example-header-image"
          />
        </div>
        <div>
          <h2 class="h2">{{ selectedChart.chart.name }}</h2>
        </div>
      </div>
      <mat-card-content>
        <mat-divider></mat-divider>

        <app-svg-point-chart
          (pointSelected)="pointSelected($event, selectedChart)"
          [pointChart]="selectedChart.chart.pointChart"
        ></app-svg-point-chart>

        <p class="mat-body" *ngIf="selectedChart.chart.rates.length > 0">
          Collected points: {{ selectedChart.chart.rates.length }}
        </p>
        <cdk-virtual-scroll-viewport
          [itemSize]="itemHeight"
          [style.height.px]="itemHeight * itemOnView"
        >
          <div
            [ngClass]="{ 'odd-item': odd, 'even-item': even }"
            [style.height.px]="itemHeight"
            class="viewport-item"
            *cdkVirtualFor="
              let rate of selectedChart.chart.rates;
              let index = index;
              let count = count;
              let first = first;
              let last = last;
              let even = even;
              let odd = odd
            "
          >
            <div
              fxLayout
              fxLayoutAlign="space-between"
              [style.height.px]="itemHeight"
            >
              <h4 class="mat-h4">
                {{ index + 1 }} | {{ rate.time | date: "medium" }} |
                <strong>{{ rate.rate }}</strong>
              </h4>
            </div>
          </div>
        </cdk-virtual-scroll-viewport>
      </mat-card-content>
    </mat-card>
  </ng-container>
</div>
